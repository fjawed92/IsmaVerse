{% extends "base.html" %}
{% block title %}Admin - Users{% endblock %}

{% block content %}
<div class="container py-4">
  <div class="admin-hero mb-4">
    <div class="admin-hero-label">ADMIN HQ</div>
    <h1 class="admin-hero-title no-shadow">User Squad</h1>
    <p class="admin-hero-subtitle mb-0">Manage heroes, sidekicks, and helpers with colorful controls.</p>
  </div>

  <div class="d-flex align-items-center justify-content-between mb-3 flex-wrap gap-2">
    <div class="d-flex align-items-center gap-2">
      <span class="burst">ROSTER</span>
      <span class="text-muted">Tap a badge to edit powers.</span>
    </div>
    <a class="btn btn-comic-cta" href="{{ url_for('admin.admin_create_user') }}">+ New User</a>
  </div>

  {% if users %}
    <div class="comic-panel admin-panel">
      <div class="panel-header d-flex align-items-center justify-content-between">
        <h2 class="panel-title m-0">Secret Identity Files</h2>
        <span class="badge rounded-pill text-bg-warning admin-count">{{ users|length }} total</span>
      </div>
      <div class="table-responsive">
        <table class="table comic-table align-middle mb-0">
          <thead>
            <tr>
              <th style="width:90px;">ID</th>
              <th>Username / Email</th>
              <th style="width:200px;">Roles</th>
              <th style="width:200px;">Created</th>
              <th style="width:220px;" class="text-end">Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for user in users %}
            <tr>
              <td class="fw-bold">#{{ user.id }}</td>
              <td>
                <div class="fw-semibold">{{ user.username }}</div>
                {% if user.email %}
                  <div class="text-muted small">{{ user.email }}</div>
                {% else %}
                  <div class="text-muted small">No email</div>
                {% endif %}
              </td>
              <td>
                <span class="admin-role-pill">{{ user.roles }}</span>
              </td>
              <td class="text-muted">
                {% if user.created_at %}
                  {{ user.created_at.strftime("%b %d, %Y %I:%M %p") }}
                {% else %}
                  â€”
                {% endif %}
              </td>
              <td class="text-end">
                <a class="btn btn-sm comic-outline-btn btn-outline-primary" href="{{ url_for('admin.admin_edit_user', user_id=user.id) }}">Edit</a>
                <form class="d-inline" method="POST" action="{{ url_for('admin.admin_delete_user', user_id=user.id) }}" onsubmit="return confirm('Delete this user? This cannot be undone.');">
                  <button type="submit" class="btn btn-sm comic-outline-btn btn-outline-danger">Delete</button>
                </form>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  {% else %}
    <div class="speech">
      <div class="d-flex align-items-center gap-2">
        <span class="burst">UH-OH</span>
        <div>No users found. Recruit a new hero!</div>
      </div>
    </div>
  {% endif %}
</div>
{% endblock %}
